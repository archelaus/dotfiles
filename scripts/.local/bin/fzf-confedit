#!/usr/bin/env bash

source $HOME/.config/dmscripts/config

declare -A _clean_list
for i in "${!confedit_list[@]}"; do
  [[ -f ${confedit_list[$i]} ]] && _clean_list[$i]=${confedit_list[$i]}
done

d0=("${_clean_list[@]}")
files=("${d0[@]}"
~/.config/rofi/scripts/*
~/.config/shell/*
~/.config/tmux/*
~/.config/x11/*
~/.local/bin/,*
~/.local/bin/tmux-*
~/.local/bin/fzf-*
~/.notes/*.md
)

choice=$(printf '%s\n' "${files[@]}" |
  fzf --header="fzf-confedit" --header-first \
  --expect=ctrl-f \
  --bind 'page-down:preview-down,page-up:preview-up' --preview="bat --color always {}")

if [[ $choice ]]; then
  key_pressed=$(echo "$choice" | head -n1)
  choice=$(echo "$choice" | tail -n+2)
  if [[ $key_pressed = "ctrl-f" ]]; then
    bat --style header,grid "$choice"
  else
    $DMEDITOR "$choice" &
  fi
  # cfg=$(printf '%s\n' "${_clean_list["$choice"]}")
  # $DMEDITOR "$cfg"
  # choice=$( printf "$choice" | sed "s|$HOME|~|" )
  # xdotool type --delay 0 "vim $choice"
else
  echo "[âœ“] Program exited"; exit 0
fi
