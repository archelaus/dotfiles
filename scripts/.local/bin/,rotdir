#!/usr/bin/env bash

[[ $# -eq 0 ]] &&  { echo "Usage: ${0##*/} </path/to/directory>"; exit 1; }

# fp () {
#   case "$1" in
#     /*) printf '%s\n' "$1";;
#     *) printf '%s\n' "$PWD/$1";;
#   esac
# }

files() {
  find "$(readlink -f "$1")" -maxdepth 1 -type f -print0 |
    sort -z |
    xargs -0 file --mime-type |
    grep -F 'image/' |
    cut -d ':' -f 1
}

files2() {
  find "$(readlink -f "$1")" -type f -print0 -maxdepth 1 -iregex \
    '.*\(jpe?g\|png\)$' | sort -z
}

if [[ -d $1 ]]; then
  files "$1" | nsxiv -0 -t -i
else
  target="$(basename "$1")"
  index=$(files2 "$(dirname "$1")" | grep -zZn "$target" | cut -d: -f1)
  files2 "$(dirname "$1")" | nsxiv -0 -in $index
fi
